import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import type { AIAnalysis, Vulnerability } from "@/types/scan-types"
import { Code, Lightbulb, Shield } from "lucide-react"
import { DetailsTab } from "./tabs/details-tab"
import { RawDataTab } from "./tabs/raw-data-tab"
import { AIAnalysisTab } from "./tabs/ai-analysis-tab"
import { VulnerabilityBadge } from "./vulnerability-badge"
import { useState } from "react"


interface VulnerabilityDetailsDialogProps {
  vulnerability: Vulnerability | null
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function VulnerabilityDetailsDialog({ vulnerability, open, onOpenChange }: VulnerabilityDetailsDialogProps) {
  const [aiAnalysis, setAiAnalysis] = useState<AIAnalysis | null>(null)
  if (!vulnerability) return null

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-4xl">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <VulnerabilityBadge severity={vulnerability.severity} />
            <span>{vulnerability.title}</span>
          </DialogTitle>
          <DialogDescription>Análisis detallado de la vulnerabilidad detectada</DialogDescription>
        </DialogHeader>

        <Tabs defaultValue="details" className="mt-4">
          <TabsList>
            <TabsTrigger value="details" className="flex items-center gap-2">
              <Shield className="h-4 w-4" />
              Detalles
            </TabsTrigger>
            <TabsTrigger value="raw" className="flex items-center gap-2">
              <Code className="h-4 w-4" />
              Datos Raw
            </TabsTrigger>
            <TabsTrigger value="ai" className="flex items-center gap-2">
              <Lightbulb className="h-4 w-4" />
              Análisis IA
            </TabsTrigger>
          </TabsList>

          <TabsContent value="details" className="space-y-4">
            <DetailsTab vulnerability={vulnerability} />
          </TabsContent>

          <TabsContent value="raw" className="space-y-4">
            <RawDataTab vulnerability={vulnerability} />
          </TabsContent>

          <TabsContent value="ai" className="space-y-4">
            <AIAnalysisTab vulnerability={vulnerability} aiAnalysis={aiAnalysis} setAiAnalysis={setAiAnalysis} />
          </TabsContent>
        </Tabs>
      </DialogContent>
    </Dialog>
  )
}

